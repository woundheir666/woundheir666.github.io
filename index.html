<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOUNDHEIR</title>
    <style>
        /* Courier New is the default system monospace */

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --green: #00FFFF;
            --green-dim: #00cccc;
            --bg: #000000;
            --accent1: #FF00FF;
            --accent2: #FFFF00;
            --ticker-bg: #0000CC;
            --chrome-bg: var(--green);
            --chrome-head-bg: #000000;
            --chrome-head-fg: var(--green);
            --chrome-hover-fg: var(--green);
            --bar-height: 30px;
        }

        body {
            background: #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
        }

        /* ── TERMINAL BOX ── */
        .terminal {
            width: 96vw;
            max-width: 1200px;
            min-height: 92vh;
            background: var(--bg);
            color: var(--green);
            font-size: 23px;
            line-height: 1.35;
            text-shadow: 0 0 3px var(--green);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* CRT scanlines overlay (content area) */
        .terminal.scanlines-on .content::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: repeating-linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.35) 0px,
                rgba(0, 0, 0, 0.35) 1px,
                rgba(0, 0, 0, 0.0) 1.5px,
                rgba(0, 0, 0, 0.0) 3px
            );
            mix-blend-mode: multiply;
            z-index: 2;
        }

        /* CRT scanlines overlay on URL/footer bar */
        .terminal.scanlines-on .url-bar::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: repeating-linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.35) 0px,
                rgba(0, 0, 0, 0.35) 1px,
                rgba(0, 0, 0, 0.0) 1.5px,
                rgba(0, 0, 0, 0.0) 3px
            );
            mix-blend-mode: multiply;
            z-index: 1;
        }

        /* CRT scanlines on ticker bar */
        .terminal.scanlines-on .ticker-bar::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: repeating-linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.35) 0px,
                rgba(0, 0, 0, 0.35) 1px,
                rgba(0, 0, 0, 0.0) 1.5px,
                rgba(0, 0, 0, 0.0) 3px
            );
            mix-blend-mode: multiply;
            z-index: 1;
        }

        /* CRT flicker effect (subtle but visible) */
        .terminal.flicker-on {
            animation: crt-flicker 0.10s infinite;
        }

        @keyframes crt-flicker {
            0%   { opacity: 0.95; filter: brightness(0.97); }
            50%  { opacity: 1.00; filter: brightness(1.03); }
            100% { opacity: 0.96; filter: brightness(0.985); }
        }

        /* Glitch effect */
        /* Glitch — pixel-shift corruption, no hue rotate, just digital breakup */
        .terminal.glitch-on {
            animation: glitch 6s infinite;
        }
        @keyframes glitch {
            0%, 96%, 100% { transform: none; clip-path: none; }
            96.5% { transform: translateX(-3px); clip-path: inset(15% 0 70% 0); }
            97%   { transform: translateX(4px);  clip-path: inset(55% 0 20% 0); }
            97.5% { transform: translateX(-2px); clip-path: inset(80% 0 5% 0); }
            98%   { transform: translateX(2px);  clip-path: none; }
            98.5% { transform: none; }
        }

        /* Dynamic noise — animated scanline interference, like a dying CRT */
        .terminal.dynoise-on::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 998;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 1px,
                rgba(128,128,128,0.03) 1px,
                rgba(128,128,128,0.03) 3px
            );
            animation: dynoise-drift 0.2s steps(3) infinite;
        }
        @keyframes dynoise-drift {
            0%   { background-position: 0 0;    opacity: 0.5; }
            33%  { background-position: 0 -6px; opacity: 0.6; }
            66%  { background-position: 0 3px;  opacity: 0.5; }
            100% { background-position: 0 0;    opacity: 0.6; }
        }

        /* RGB split / chromatic aberration */
        .terminal.rgb-on .content,
        .terminal.rgb-on .boot-screen,
        .terminal.rgb-on .menu-bar,
        .terminal.rgb-on .ticker-bar,
        .terminal.rgb-on .url-bar {
            text-shadow:
                -2px 0 rgba(255,0,0,0.5),
                2px 0 rgba(0,255,255,0.5),
                0 0 3px var(--green);
        }

        /* Horizontal raster bars — coloured scanlines like a PETSCII demo */
        .terminal.raster-on .content::after,
        .terminal.raster-on .boot-screen::after {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 10;
            background: repeating-linear-gradient(
                to bottom,
                rgba(var(--green-rgb, 0,255,100), 0.03) 0px,
                rgba(var(--green-rgb, 0,255,100), 0.03) 2px,
                transparent 2px,
                transparent 6px
            );
            animation: raster-shift 0.5s steps(3) infinite;
        }
        @keyframes raster-shift {
            0%   { background-position: 0 0; }
            100% { background-position: 0 6px; }
        }

        /* Pixel bleed — slight horizontal smear on text, old LCD ghosting */
        .terminal.bleed-on .content,
        .terminal.bleed-on .boot-screen,
        .terminal.bleed-on .menu-bar,
        .terminal.bleed-on .url-bar {
            filter: blur(0.3px) contrast(1.4);
            letter-spacing: 0.5px;
        }

        /* ── MENU BAR ── */
        .menu-bar {
            display: flex;
            align-items: center;
            height: var(--bar-height);
            background: var(--accent1);
            color: #000000;
            text-shadow: none;
            font-size: 21px;
            padding: 0 6px;
            position: relative;
            z-index: 100;
            user-select: none;
            flex-shrink: 0;
        }

        .menu-items {
            display: flex;
            flex: 1;
            min-width: 0;
        }

        .menu-item {
            padding: 0 16px 0 6px;
            cursor: pointer;
            position: relative;
        }

        .menu-item u { text-decoration: underline; }

        /* Selected menu title: same blue as Terminal options header so it stays visible (e.g. Win95) */
        .menu-item.active {
            background: var(--chrome-head-bg, #000080);
            color: var(--chrome-head-fg, #FFFFFF);
            text-shadow: none;
        }


        /* ── DROPDOWN ── */
        .dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--chrome-bg, var(--accent1));
            color: #000000;
            text-shadow: none;
            min-width: 220px;
            z-index: 500;
            border: 2px solid #000000;
            font-size: 21px;
            overflow: visible; /* allow Open and Music submenus to show */
        }

        .menu-item.active .dropdown { display: block; }

        /* Light scanlines on dropdowns so menu text stays readable */
        .terminal.scanlines-on .menu-item.active .dropdown::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: repeating-linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.10) 0px,
                rgba(0, 0, 0, 0.10) 1px,
                rgba(0, 0, 0, 0.0) 1.5px,
                rgba(0, 0, 0, 0.0) 3px
            );
            mix-blend-mode: multiply;
        }

        .dd-item {
            padding: 2px 14px 2px 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            white-space: nowrap;
            color: #000000;
        }

        .dd-item:hover, .dd-item.hl {
            background: var(--chrome-head-bg, #000080);
            color: var(--chrome-head-fg, #FFFFFF);
            text-shadow: none;
        }

        .dd-sep {
            border-top: 1px solid #000000;
            margin: 2px 0;
            opacity: 0.4;
        }

        /* Language submenu */
        .has-sub { position: relative; }

        .submenu {
            display: none;
            position: absolute;
            top: 0;
            left: calc(100% - 1px);
            background: var(--chrome-bg, var(--accent1));
            color: #000000;
            text-shadow: none;
            min-width: 160px;
            border: 2px solid #000000;
            z-index: 700;
            font-size: 21px;
        }

        .has-sub:hover .submenu,
        .submenu:hover { display: block; }

        .sub-item {
            padding: 2px 14px 2px 10px;
            cursor: pointer;
            white-space: nowrap;
            color: #000000;
        }

        .sub-item:hover, .sub-item.active-lang {
            background: var(--chrome-head-bg, #000080);
            color: var(--chrome-head-fg, #FFFFFF);
            text-shadow: none;
        }

        .sub-item.has-sub {
            position: relative;
            display: flex;
            justify-content: space-between;
        }
        .sub-item.has-sub .submenu { z-index: 701; }

        /* ── CONTENT AREA ── */
        .content {
            flex: 1;
            padding: 10px 16px;
            position: relative;
            overflow-y: auto;
        }

        /* Windows 95–style scrollbar (theme palette); no up/down buttons, thumb only */
        .content::-webkit-scrollbar,
        .popup::-webkit-scrollbar {
            width: 22px;
        }
        .content::-webkit-scrollbar-track,
        .popup::-webkit-scrollbar-track {
            background: var(--scroll-track, var(--chrome-bg, #c0c0c0));
        }
        .content::-webkit-scrollbar-thumb,
        .popup::-webkit-scrollbar-thumb {
            background: var(--scroll-thumb, var(--chrome-bg, #c0c0c0));
            border: none;
            border-radius: 0;
        }
        .content::-webkit-scrollbar-thumb:hover,
        .popup::-webkit-scrollbar-thumb:hover {
            background: var(--scroll-thumb-hover, var(--scroll-thumb, var(--chrome-bg)));
        }
        .content::-webkit-scrollbar-button,
        .popup::-webkit-scrollbar-button {
            height: 0;
            width: 0;
            display: none;
        }
        .content::-webkit-scrollbar-corner,
        .popup::-webkit-scrollbar-corner {
            background: var(--scroll-track, var(--chrome-bg, #c0c0c0));
        }

        .c {
            display: block;
            color: var(--green);
        }

        .inv {
            background: var(--accent2);
            color: #000000;
            text-shadow: none;
        }

        .lnk {
            color: var(--green);
            text-decoration: underline;
            cursor: pointer;
        }
        .lnk:hover {
            background: var(--green);
            color: #000000;
            text-shadow: none;
        }

        /* ── FLOATING POPUP (Setup etc) ── */
        .popup {
            display: none;
            position: absolute;
            top: 10px;
            left: 50%;
            background: var(--chrome-bg, var(--accent1));
            color: #000000;
            text-shadow: none;
            min-width: 240px;
            max-height: 75vh;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 300;
            border: 2px solid #000000;
            font-size: 21px;
        }

        .popup.open { display: block; }
        #terminalPopup { overflow-x: visible; }

        .popup-head {
            background: var(--chrome-head-bg, #000000);
            color: var(--chrome-head-fg, var(--green));
            text-shadow: 0 0 3px var(--chrome-head-fg);
            padding: 2px 10px;
            font-size: 21px;
        }

        .popup-item {
            padding: 2px 14px 2px 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            white-space: nowrap;
            color: #000000;
        }

        .popup-item:hover, .popup-item.hl {
            background: var(--popup-hover-bg, #000000);
            color: var(--popup-hover-fg, var(--green));
            text-shadow: 0 0 3px var(--popup-hover-fg, var(--green));
        }

        .popup-sep {
            border-top: 1px solid #000000;
            margin: 2px 6px;
            opacity: 0.4;
        }

        .popup-item.effect-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }
        .popup-item.effect-row .effect-value {
            min-width: 5em;
            text-align: right;
        }

        /* ── TICKER BAR ── */
        .ticker-bar {
            background: var(--ticker-bg);
            color: var(--ticker-fg, var(--green));
            text-shadow: 0 0 2px var(--ticker-fg, var(--green));
            font-size: 21px;
            height: var(--bar-height);
            padding: 0 6px;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
        }
        .ticker-track {
            display: flex;
            width: max-content;
            will-change: transform;
        }
        .ticker-text {
            white-space: nowrap;
            padding-right: 3em;
        }
        .ticker-text .ticker-malware {
            color: var(--accent2, var(--green));
            font-weight: bold;
            text-shadow: 0 0 4px var(--accent2, var(--green));
        }

        /* ── URL BAR ── */
        .url-bar {
            background: var(--accent1);
            color: #000000;
            text-shadow: none;
            font-size: 20px;
            padding: 2px 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }
        
        .url-session {
            font-size: 18px;
            white-space: nowrap;
            margin-left: auto;
            padding-left: 12px;
        }

        .url-left {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .url-session {
            font-size: 18px;
        }

        /* Cursor: flashes between normal and inverse (black on var(--green)) */
        .cursor {
            color: #000000;
            animation: cursor-inv-blink 1s step-end infinite;
        }
        .content .cursor {
            color: var(--green);
        }

        @keyframes cursor-inv-blink {
            0%, 50% {
                background: transparent;
                color: inherit;
                text-shadow: inherit;
            }
            50.01%, 100% {
                background: var(--green);
                color: #000000 !important;
                text-shadow: none;
            }
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Boot screen */
        .boot-screen, .main-content {
            position: absolute;
            inset: 0;
            padding: 10px 16px;
            overflow-y: auto;
        }
        .boot-screen { z-index: 1; }
        .main-content {
            display: none;
            z-index: 0;
        }
        .main-content.visible { display: block; }
        .boot-screen.fade-out { opacity: 0; pointer-events: none; transition: opacity 0.6s ease-out; }
        .boot-line { display: block; min-height: 1.35em; }
        .boot-line .c { display: inline; }
        .boot-prompt-cursor {
            display: inline;
            color: var(--green);
            background: transparent !important;
            text-shadow: inherit;
            animation: boot-cursor-blink 1s step-end infinite;
        }
        @keyframes boot-cursor-blink {
            0%, 50% { opacity: 1; }
            50.01%, 100% { opacity: 0; }
        }
        .boot-status-ok { color: inherit; }
        .boot-status-corrupted {
            background: var(--green);
            color: var(--bg);
            padding: 0 4px;
            text-shadow: none;
            font-weight: bold;
            letter-spacing: 2px;
        }
        .boot-prompt-line { display: block; margin-top: 0.5em; }
        .boot-screen .cursor, .main-content .cursor { animation: cursor-inv-blink 1s step-end infinite; }
        .main-content .cursor { color: var(--green); }
        .fade-to-black { background: #000 !important; transition: background 0.8s ease-out; }
        .fade-to-black .content { background: #000 !important; }

        /* About page (boot-screen style) */
        .about-page {
            position: absolute;
            inset: 0;
            z-index: 15;
            background: var(--bg);
            color: var(--green);
            text-shadow: 0 0 3px var(--green);
            padding: 16px 20px;
            overflow-y: auto;
            font-size: 20px;
            line-height: 1.4;
            display: none;
        }
        .about-page.open { display: block; }
        .about-page .about-inner { max-width: 680px; margin: 0 auto; }
        .about-page .about-portrait {
            font-family: 'Courier New', monospace;
            white-space: pre;
            font-size: 10px;
            line-height: 1.15;
            margin: 12px 0 20px;
            letter-spacing: 0.5px;
            color: var(--green);
        }
        .about-page .about-text { margin-bottom: 1em; }
        .about-page .about-close {
            margin-top: 16px;
            cursor: pointer;
            display: inline-block;
            padding: 4px 12px;
            border: 1px solid var(--green);
        }
        .about-page .about-close:hover { background: var(--green); color: var(--bg); text-shadow: none; }

        /* ── PORTFOLIO GRID ── */
        #portfolioGrid {
            display: none;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 0;
            position: absolute;
            inset: 0;
        }

        .p-tile {
            border: 1px solid var(--bg);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            text-decoration: none;
            overflow: hidden;
            position: relative;
        }

        .p-gif {
            flex: 1;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--green);
            font-size: 18px;
            overflow: hidden;
            position: relative;
        }

        .p-gif img,
        .p-gif video {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .p-label {
            flex-shrink: 0;
            background: var(--label-bg, var(--green));
            color: var(--label-fg, #000000);
            text-align: center;
            font-size: 18px;
            padding: 4px 0;
            text-shadow: none;
            letter-spacing: 2px;
            opacity: 1;
        }
        .p-tile:hover .p-label {
            color: var(--chrome-head-fg, var(--green));
            background: var(--chrome-head-bg, #000080);
            text-shadow: 0 0 4px rgba(255,255,255,0.5);
        }

        /* color theme transitions */
        * { transition: color 0.2s, background-color 0.2s, text-shadow 0.2s; }
        .terminal, .menu-bar, .ticker-bar, .url-bar, .dropdown, .submenu, .popup { transition: none; }
    </style>
</head>
<body>

<div class="terminal scanlines-on" id="terminal">

    <!-- MENU BAR -->
    <div class="menu-bar" id="menuBar">
        <div class="menu-items">

            <!-- FILE -->
            <div class="menu-item" id="mFile" onclick="toggleMenu('mFile', event)">
                <span data-i18n="menu_file"><u>F</u>ile</span>
                <div class="dropdown">
                    <div class="dd-item" onclick="closeAll(); window.open(window.location.href, '_blank');" data-i18n="file_newwin">New window</div>
                    <div class="dd-item has-sub" id="fileOpenSubTrigger" onmouseenter="showFileOpenSub()" onmouseleave="hideFileOpenSub()">
                        <span data-i18n="file_open">Open</span>
                        <span>›</span>
                        <div class="submenu" id="fileOpenSubmenu" onmouseenter="showFileOpenSub()" onmouseleave="hideFileOpenSub()">
                            <div class="sub-item" onclick="closeAll(); window.open('https://x.com/woundheir__', '_blank');" data-i18n="link_x">X</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://objkt.com/users/tz1ZsKoaQgjZegNKE7P9Rn9DyUtetFvdJQcm', '_blank');" data-i18n="open_objkt">Objkt</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://katod-project.itch.io/', '_blank');" data-i18n="open_itch">Itch.io</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://teia.art/woundheir', '_blank');" data-i18n="open_teia">Teia</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://www.artstation.com/woundheir', '_blank');" data-i18n="link_artstation">Artstation</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://soundcloud.com/woundheir', '_blank');" data-i18n="link_soundcloud">Soundcloud</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://linkedin.com/in/omidrasipour/', '_blank');" data-i18n="link_linkedin">LinkedIn</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://objkt.com/tokens/open_objkt/30243', '_blank');" data-i18n="open_latest">Latest artwork</div>
                        </div>
                    </div>
                    <div class="dd-sep"></div>
                    <div class="dd-item" onclick="closeAll(); window.open('https://woundheir.com/merch', '_blank');" data-i18n="file_print">Print</div>
                    <div class="dd-sep"></div>
                    <div class="dd-item" onclick="closeAll(); window.close();" data-i18n="file_exit">Exit</div>
                </div>
            </div>

            <!-- VIEW -->
            <div class="menu-item" id="mView" onclick="toggleMenu('mView', event)">
                <span data-i18n="menu_view"><u>V</u>iew</span>
                <div class="dropdown">
                    <div class="dd-item hl" data-i18n="view_normal">Default view</div>
                    <div class="dd-item" onclick="toggleFullscreen()" data-i18n="view_full">Fullscreen</div>
                    <div class="dd-item" onclick="location.reload()" data-i18n="view_reload">Refresh signal</div>
                    <div class="dd-item" onclick="viewSource()" data-i18n="view_source">Source</div>
                </div>
            </div>

            <!-- LINK: Portfolio (Artstation, LinkedIn), Socials -->
            <div class="menu-item" id="mLink" onclick="toggleMenu('mLink', event)">
                <span data-i18n="menu_link"><u>L</u>ink</span>
                <div class="dropdown">
                    <div class="dd-item has-sub" id="portfolioSubTriggerLink" onmouseenter="showPortfolioSubLink()" onmouseleave="hidePortfolioSubLink()">
                        <span data-i18n="link_portfolio">Portfolio</span>
                        <span>›</span>
                        <div class="submenu" id="portfolioSubmenuLink" onmouseenter="showPortfolioSubLink()" onmouseleave="hidePortfolioSubLink()">
                            <div class="sub-item" onclick="closeAll(); window.open('https://www.artstation.com/woundheir', '_blank');" data-i18n="link_artstation">Artstation</div>
                            <div class="sub-item" onclick="closeAll(); window.open('https://linkedin.com/in/omidrasipour/', '_blank');" data-i18n="link_linkedin">LinkedIn</div>
                        </div>
                    </div>
                    <div class="dd-item has-sub" id="socialsSubTriggerLink" onmouseenter="showSocialsSubLink()" onmouseleave="hideSocialsSubLink()">
                        <span data-i18n="link_socials">Socials</span>
                        <span>›</span>
                        <div class="submenu" id="socialsSubmenuLink" onmouseenter="showSocialsSubLink()" onmouseleave="hideSocialsSubLink()">
                            <div class="sub-item" onclick="closeAll(); window.open('https://x.com/woundheir', '_blank');" data-i18n="link_x">X (Twitter)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DOWNLOADS -->
            <div class="menu-item" id="mDownloads" onclick="toggleMenu('mDownloads', event)">
                <span data-i18n="menu_dl"><u>D</u>ownloads</span>
                <div class="dropdown">
                    <div class="dd-item" onclick="closeAll(); window.open('https://woundheir.com/bandcamp', '_blank');" data-i18n="dl_music">Music</div>
                    <div class="dd-item" onclick="closeAll(); window.open('https://woundheir.com/wallpaper', '_blank');" data-i18n="dl_wall">Wallpaper</div>
                    <div class="dd-item" onclick="closeAll(); window.open('https://woundheir.com/wallpaper', '_blank');" data-i18n="dl_gif">Gif</div>
                </div>
            </div>

            <!-- SETUP -->
            <div class="menu-item" id="mSetup" onclick="toggleMenu('mSetup', event)">
                <span data-i18n="menu_setup"><u>S</u>etup</span>
                <div class="dropdown" style="min-width:250px;">
                    <!-- Language with submenu -->
                    <div class="dd-item has-sub" id="langSubTrigger" onmouseenter="showLangSub()" onmouseleave="hideLangSub()">
                        <span data-i18n="setup_lang">Language</span>
                        <span>›</span>
                        <div class="submenu" id="langSubmenu" onmouseenter="showLangSub()" onmouseleave="hideLangSub()">
                            <div class="sub-item active-lang" id="lang-en" onclick="setLang('en', event)">English ✓</div>
                            <div class="sub-item" id="lang-it" onclick="setLang('it', event)">Italiano</div>
                            <div class="sub-item" id="lang-fr" onclick="setLang('fr', event)">Français</div>
                        </div>
                    </div>
                    <!-- Terminal options — opens popup -->
                    <div class="dd-item" onclick="openPopup('terminalPopup', event)" data-i18n="setup_terminal">Terminal options</div>
                    <div class="dd-sep"></div>
                    <div class="dd-item" onclick="resetTerminalOptions()" data-i18n="setup_reset">Reset terminal to defaults</div>
                </div>
            </div>

            <!-- HELP -->
            <div class="menu-item" id="mHelp" onclick="toggleMenu('mHelp', event)">
                <span data-i18n="menu_help"><u>H</u>elp</span>
                <div class="dropdown">
                    <div class="dd-item" onclick="openAboutPage(event)" data-i18n="help_about">About</div>
                    <div class="dd-item" onclick="closeAll(); window.location.href='mailto:omidrasipour@gmail.com';" data-i18n="help_contact">Contact</div>
                </div>
            </div>

        </div>
    </div>

    <!-- TICKER (content filled by JS for random order; scroll speed smoothed on hover) -->
    <div class="ticker-bar" id="tickerBar">
        <div class="ticker-track" id="tickerTrack">
            <span class="ticker-text" id="tickerSpan1"></span>
            <span class="ticker-text" id="tickerSpan2"></span>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content" id="content" onclick="closeAll()">

        <div id="bootScreen" class="boot-screen">
            <div id="bootLines"></div>

            <!-- PORTFOLIO GRID — order: X, Objkt, Itch.io, Teia, Artstation, Soundcloud, LinkedIn, Latest artwork -->
            <div id="portfolioGrid">
                <a href="https://x.com/woundheir__" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/x.gif" alt="">
                    </div>
                    <div class="p-label">X</div>
                </a>
                <a href="https://objkt.com/users/tz1ZsKoaQgjZegNKE7P9Rn9DyUtetFvdJQcm" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/objkt.gif" alt="">
                    </div>
                    <div class="p-label">OBJKT</div>
                </a>
                <a href="https://katod-project.itch.io/" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/itch.gif" alt="">
                    </div>
                    <div class="p-label">ITCH.IO</div>
                </a>
                <a href="https://teia.art/woundheir" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/teia.gif" alt="">
                    </div>
                    <div class="p-label">TEIA</div>
                </a>
                <a href="https://www.artstation.com/woundheir" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/artstation.gif" alt="">
                    </div>
                    <div class="p-label">ARTSTATION</div>
                </a>
                <a href="https://soundcloud.com/woundheir" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/soundcloud.gif" alt="">
                    </div>
                    <div class="p-label">SOUNDCLOUD</div>
                </a>
                <a href="https://linkedin.com/in/omidrasipour/" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/empty.gif" alt="">
                    </div>
                    <div class="p-label">LINKEDIN</div>
                </a>
                <a href="https://objkt.com/tokens/open_objkt/30243" target="_blank" class="p-tile">
                    <div class="p-gif">
                        <img src="gifs/latest-artwork.gif" alt="">
                    </div>
                    <div class="p-label">LATEST ARTWORK</div>
                </a>
            </div>

            <!-- ABOUT PAGE (boot-style overlay) -->
            <div id="aboutPage" class="about-page">
                <div class="about-inner">
                    <div class="about-portrait" aria-hidden="true">
  _____
 |  o  |
 | ___ |
 |/   \|
 |_____|
  |   |
  |___|
                    </div>
                    <div class="about-text">
                        <strong>woundheir</strong> — digital artist & creative developer.<br><br>
                        This is a sample about me. You can replace it later with your own bio: music, visuals, games, and experiments on the web and on-chain. Based somewhere between pixels and noise.
                    </div>
                    <div class="about-close" onclick="closeAboutPage()" data-i18n="btn_close">[ Close ]</div>
                </div>
            </div>
        </div>

        <!-- TERMINAL OPTIONS POPUP -->
        <div class="popup" id="terminalPopup" style="left:30%;">
            <div class="popup-head" data-i18n="setup_terminal">Terminal options</div>
            <div id="themeMenu"></div>
            <div class="popup-sep"></div>
            <div class="popup-item popup-section" style="opacity:0.6; cursor:default; font-size:17px;">── Font ──</div>
            <div class="popup-item hl" id="fontCourier" onclick="setFont('Courier New', this)">Courier New (default)</div>
            <div class="popup-sep"></div>
            <div class="popup-item popup-section" style="opacity:0.6; cursor:default; font-size:17px;">── Effects ──</div>
            <div class="popup-item effect-row" id="opt-scan" onclick="toggleScanlines(this)"><span class="effect-label">Scanlines</span><span class="effect-value">[ ON  ]</span></div>
            <div class="popup-item effect-row" id="opt-flicker" onclick="toggleFlicker(this)"><span class="effect-label">CRT Flicker</span><span class="effect-value">[ OFF ]</span></div>
            <div class="popup-item effect-row" id="opt-glitch" onclick="toggleGlitch(this)"><span class="effect-label">Glitch</span><span class="effect-value">[ OFF ]</span></div>
            <div class="popup-item effect-row" id="opt-dynoise" onclick="toggleDynoise(this)"><span class="effect-label">Dynamic noise</span><span class="effect-value">[ OFF ]</span></div>
            <div class="popup-item effect-row" id="opt-rgb" onclick="toggleRgb(this)"><span class="effect-label">RGB split</span><span class="effect-value">[ OFF ]</span></div>
            <div class="popup-item effect-row" id="opt-raster" onclick="toggleRaster(this)"><span class="effect-label">Raster bars</span><span class="effect-value">[ OFF ]</span></div>
            <div class="popup-item effect-row" id="opt-bleed" onclick="toggleBleed(this)"><span class="effect-label">Pixel bleed</span><span class="effect-value">[ OFF ]</span></div>
            <div class="popup-sep"></div>
            <div class="popup-item" onclick="closePopup('terminalPopup')" data-i18n="btn_close">[ Close ]</div>
        </div>

    </div>

    <!-- URL BAR -->
    <div class="url-bar" id="urlBar">
        <div class="url-left">
            <span id="urlText">http://woundheir.com</span>
        </div>
        <span class="url-session" id="sessionTimer">session 00:00</span>
    </div>

</div>

<script>
    /**
     * WOUNDHEIR terminal-style site
     * Sections: i18n → submenu helpers → setLang → themes → setColor/setFont → effects → menu/popup → boot → ticker → init
     */
    const i18n = {
        en: {
            menu_file:'<u>F</u>ile', menu_view:'<u>V</u>iew', menu_link:'<u>L</u>ink',
            menu_dl:'<u>D</u>ownloads', menu_setup:'<u>S</u>etup', menu_help:'<u>H</u>elp',
            file_open:'Open', file_newwin:'New window', file_print:'Print', file_exit:'Exit',
            open_latest:'Latest artwork', open_objkt:'Objkt', open_itch:'Itch.io', open_teia:'Teia',
            view_normal:'Default view', view_full:'Fullscreen', view_reload:'Refresh signal', view_source:'Source',
            link_art:'Visual art', link_music:'Music', link_bandcamp:'Bandcamp', link_soundcloud:'Soundcloud',
            link_games:'Games', link_shop:'Shop', link_portfolio:'Portfolio', link_artstation:'Artstation',
            link_socials:'Socials', link_x:'X (Twitter)', link_linkedin:'LinkedIn',
            dl_music:'Music', dl_wall:'Wallpaper', dl_gif:'Gif',
            setup_lang:'Language', setup_terminal:'Terminal options', setup_misc:'Miscellaneous options',
            setup_cache:'Cache', setup_mail:'Mail and telnet', setup_assoc:'Associations',
            setup_ext:'File extensions', setup_save:'Save options',
            setup_reset:'Reset terminal to defaults',
            help_about:'About', help_contact:'Contact',
            term_color:'── Color scheme ──', term_green:'Green (default)', term_amber:'Amber',
            term_white:'White', term_red:'Red', term_blue:'Blue', term_dosblue:'MS-DOS blue',
            term_apple2:'Apple II green', term_c64:'Commodore 64', term_teletext:'Teletext', term_casio:'Casio / Retro display',
            term_mode:'── Display mode ──',
            mode_mono:'Monochrome colors', mode_dos:'MS-DOS blue (default)',
            term_font:'── Font ──', font_vt:'VT323', font_courier:'Consolas',
            font_mono:'Courier New (default)',
            misc_scan:'Scanlines', misc_flicker:'CRT Flicker',
            btn_close:'[ Close ]',
        },
        it: {
            menu_file:'<u>F</u>ile', menu_view:'<u>V</u>iew', menu_link:'<u>L</u>ink',
            menu_dl:'<u>D</u>ownloads', menu_setup:'<u>S</u>etup', menu_help:'<u>H</u>elp',
            file_open:'Apri', file_newwin:'Nuova finestra', file_print:'Stampa', file_exit:'Esci',
            open_latest:'Ultimo artwork', open_objkt:'Objkt', open_itch:'Itch.io', open_teia:'Teia',
            view_normal:'Vista predefinita', view_full:'Schermo intero', view_reload:'Aggiorna segnale', view_source:'Sorgente',
            link_art:'Arte visiva', link_music:'Musica', link_bandcamp:'Bandcamp', link_soundcloud:'Soundcloud',
            link_games:'Giochi', link_shop:'Shop', link_portfolio:'Portfolio', link_artstation:'Artstation',
            link_socials:'Social', link_x:'X (Twitter)', link_linkedin:'LinkedIn',
            dl_music:'Musica', dl_wall:'Sfondo', dl_gif:'Gif',
            setup_lang:'Lingua', setup_terminal:'Opzioni terminale', setup_misc:'Altre opzioni',
            setup_cache:'Cache', setup_mail:'Mail e telnet', setup_assoc:'Associazioni',
            setup_ext:'Estensioni file', setup_save:'Salva opzioni',
            setup_reset:'Ripristina terminale predefinito',
            help_about:'Informazioni', help_contact:'Contatto',
            term_color:'── Schema colori ──', term_green:'Verde (predefinito)', term_amber:'Ambra',
            term_white:'Bianco', term_red:'Rosso', term_blue:'Blu', term_dosblue:'Blu MS-DOS',
            term_apple2:'Apple II verde', term_c64:'Commodore 64', term_teletext:'Teletext', term_casio:'Casio / Retro',
            term_mode:'── Modalità display ──',
            mode_mono:'Colori monocromatici', mode_dos:'Blu MS-DOS (predefinito)',
            term_font:'── Font ──', font_vt:'VT323', font_courier:'Consolas',
            font_mono:'Courier New (predefinito)',
            misc_scan:'Scanlines', misc_flicker:'Schermo CRT',
            btn_close:'[ Chiudi ]',
        },
        fr: {
            menu_file:'<u>F</u>ichier', menu_view:'<u>A</u>ffichage', menu_link:'<u>L</u>ien',
            menu_dl:'<u>T</u>éléchargements', menu_setup:'<u>C</u>onfig', menu_help:'<u>?</u>Aide',
            file_open:'Ouvrir', file_newwin:'Nouvelle fenêtre', file_print:'Imprimer', file_exit:'Quitter',
            open_latest:'Dernière œuvre', open_objkt:'Objkt', open_itch:'Itch.io', open_teia:'Teia',
            view_normal:'Vue par défaut', view_full:'Plein écran', view_reload:'Rafraîchir', view_source:'Source',
            link_art:'Art visuel', link_music:'Musique', link_bandcamp:'Bandcamp', link_soundcloud:'Soundcloud',
            link_games:'Jeux', link_shop:'Boutique', link_portfolio:'Portfolio', link_artstation:'Artstation',
            link_socials:'Réseaux', link_x:'X (Twitter)', link_linkedin:'LinkedIn',
            dl_music:'Musique', dl_wall:'Fond d\'écran', dl_gif:'Gif',
            setup_lang:'Langue', setup_terminal:'Options terminal', setup_misc:'Divers',
            setup_cache:'Cache', setup_mail:'Mail et telnet', setup_assoc:'Associations',
            setup_ext:'Extensions', setup_save:'Enregistrer',
            setup_reset:'Réinitialiser le terminal',
            help_about:'À propos', help_contact:'Contact',
            term_color:'── Schéma de couleurs ──', term_green:'Vert (défaut)', term_amber:'Ambre',
            term_white:'Blanc', term_red:'Rouge', term_blue:'Bleu', term_dosblue:'Bleu MS-DOS',
            term_apple2:'Apple II vert', term_c64:'Commodore 64', term_teletext:'Teletext', term_casio:'Casio / Rétro',
            term_mode:'── Mode affichage ──',
            mode_mono:'Couleurs monochrome', mode_dos:'Bleu MS-DOS (défaut)',
            term_font:'── Police ──', font_vt:'VT323', font_courier:'Consolas',
            font_mono:'Courier New (défaut)',
            misc_scan:'Balayage', misc_flicker:'Flicker CRT',
            btn_close:'[ Fermer ]',
        }
    };

    let currentLang = 'en';
    let langSubHideTimer = null;

    function showLangSub() {
        if (langSubHideTimer) clearTimeout(langSubHideTimer);
        langSubHideTimer = null;
        const sub = document.getElementById('langSubmenu');
        if (sub) sub.style.display = 'block';
    }

    function hideLangSub() {
        langSubHideTimer = setTimeout(() => {
            const sub = document.getElementById('langSubmenu');
            if (sub) sub.style.display = 'none';
            langSubHideTimer = null;
        }, 150);
    }

    let fileOpenSubHideTimer = null;

    function showFileOpenSub() {
        if (fileOpenSubHideTimer) clearTimeout(fileOpenSubHideTimer);
        fileOpenSubHideTimer = null;
        const sub = document.getElementById('fileOpenSubmenu');
        if (sub) sub.style.display = 'block';
    }
    function hideFileOpenSub() {
        fileOpenSubHideTimer = setTimeout(() => {
            const sub = document.getElementById('fileOpenSubmenu');
            if (sub) sub.style.display = 'none';
            fileOpenSubHideTimer = null;
        }, 150);
    }

    let portfolioSubLinkHideTimer = null;
    let socialsSubLinkHideTimer = null;
    function showPortfolioSubLink() {
        if (portfolioSubLinkHideTimer) clearTimeout(portfolioSubLinkHideTimer);
        portfolioSubLinkHideTimer = null;
        const sub = document.getElementById('portfolioSubmenuLink');
        if (sub) sub.style.display = 'block';
    }
    function hidePortfolioSubLink() {
        portfolioSubLinkHideTimer = setTimeout(() => {
            const sub = document.getElementById('portfolioSubmenuLink');
            if (sub) sub.style.display = 'none';
            portfolioSubLinkHideTimer = null;
        }, 150);
    }
    function showSocialsSubLink() {
        if (socialsSubLinkHideTimer) clearTimeout(socialsSubLinkHideTimer);
        socialsSubLinkHideTimer = null;
        const sub = document.getElementById('socialsSubmenuLink');
        if (sub) sub.style.display = 'block';
    }
    function hideSocialsSubLink() {
        socialsSubLinkHideTimer = setTimeout(() => {
            const sub = document.getElementById('socialsSubmenuLink');
            if (sub) sub.style.display = 'none';
            socialsSubLinkHideTimer = null;
        }, 150);
    }

    function setLang(lang, e) {
        e.stopPropagation();
        currentLang = lang;
        // Update lang indicators
        const names = { en: 'English', it: 'Italiano', fr: 'Français' };
        ['en', 'it', 'fr'].forEach(l => {
            const el = document.getElementById('lang-' + l);
            if (!el) return;
            el.textContent = names[l] + (l === lang ? ' ✓' : '');
            el.classList.toggle('active-lang', l === lang);
        });
        // Apply translations
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (i18n[lang][key]) el.innerHTML = i18n[lang][key];
        });
        urlGo('woundheir.com/setup/language/' + lang);
        closeAll();
    }

    // ── Color themes ──
    const themes = {
        // Monochrome CRT
        green:   { green: '#39FF14', bg: '#000000', accent1: '#39FF14', accent2: '#39FF14', tickerBg: '#0a3300' },
        amber:   { green: '#FFBF00', bg: '#0a0500', accent1: '#FFBF00', accent2: '#FFBF00', tickerBg: '#332200' },
        white:   { green: '#F0F0F0', bg: '#000000', accent1: '#F0F0F0', accent2: '#F0F0F0', tickerBg: '#1a1a1a' },
        red:     { green: '#FF3333', bg: '#0a0000', accent1: '#FF3333', accent2: '#FF3333', tickerBg: '#330000' },
        blue:    { green: '#4A9EFF', bg: '#000011', accent1: '#4A9EFF', accent2: '#4A9EFF', tickerBg: '#000033' },

        compaqportable: {
            green:   '#55FF55',
            bg:      '#000000',
            accent1: '#22AA22',
            accent2: '#88FF88',
            tickerBg: '#001100',
            chromeBg:      '#22AA22',
            chromeHeadBg:  '#001100',
            chromeHeadFg:  '#55FF55',
            chromeHoverFg: '#88FF88',
        },
        segagenesis: {
            green:   '#66AAFF',
            bg:      '#000033',
            accent1: '#0033CC',
            accent2: '#FF3300',
            tickerBg: '#000011',
            chromeBg:      '#0033CC',
            chromeHeadBg:  '#001144',
            chromeHeadFg:  '#66AAFF',
            chromeHoverFg: '#99CCFF',
        },
        zxspectrum: {
            green:   '#00FFFF',
            bg:      '#000000',
            accent1: '#FF00FF',
            accent2: '#FFFF00',
            tickerBg: '#000088',
        },
        gameboycolor: {
            green:   '#00EEFF',
            bg:      '#220044',
            accent1: '#6600AA',
            accent2: '#FF44AA',
            tickerBg: '#110022',
            chromeBg:      '#6600AA',
            chromeHeadBg:  '#220044',
            chromeHeadFg:  '#00EEFF',
            chromeHoverFg: '#FF44AA',
        },
        nokia3310: {
            green:   '#1a2a0a',
            bg:      '#B8D080',
            accent1: '#3a5a1a',
            accent2: '#1a2a0a',
            tickerBg: '#5a7a2a',
            chromeBg:      '#3a5a1a',
            chromeHeadBg:  '#1a2a0a',
            chromeHeadFg:  '#B8D080',
            chromeHoverFg: '#D8F0A0',
            labelFg: '#000000',
            labelBg: '#3a5a1a',
            popupHoverBg: '#3a5a1a',
            popupHoverFg: '#D8F0A0',
        },
        casiogshock: {
            green:   '#FF6600',
            bg:      '#0a0a0a',
            accent1: '#CC4400',
            accent2: '#FF6600',
            tickerBg: '#1a0800',
        },
        casiofx330: {
            green:   '#1a3d1a',
            bg:      '#D4E8B0',
            accent1: '#5a7a4a',
            accent2: '#8B6914',
            tickerBg: '#9aac78',
            chromeBg:      '#9aac78',
            chromeHeadBg:  '#5a7a4a',
            chromeHeadFg:  '#1a3d1a',
            chromeHoverFg: '#0a1a0a',
            labelFg: '#000000',
            labelBg: '#5a7a4a',
        },
        teletext: {
            green:   '#FFFF00',
            bg:      '#0000FF',
            accent1: '#E60000',
            accent2: '#00FFFF',
            tickerBg: '#0000CC',
            chromeBg:      '#E60000',
            chromeHeadBg:  '#E60000',
            chromeHeadFg:  '#FFFF00',
            chromeHoverFg: '#FFFFFF',
        },
        winvistadark: {
            green:   '#CCE5FF',
            bg:      '#0A1A2F',
            accent1: '#1E3A5F',
            accent2: '#66AAFF',
            tickerBg: '#050A1A',
        },
        win98: {
            green:   '#FFFFFF',
            bg:      '#000080',
            accent1: '#1084D0',
            accent2: '#FFFF00',
            tickerBg: '#000040',
            chromeBg:      '#1084D0',
            chromeHeadBg:  '#000080',
            chromeHeadFg:  '#FFFFFF',
            chromeHoverFg: '#FFFF00',
        },
        win95: {
            green:   '#000000',
            bg:      '#008080',
            accent1: '#C0C0C0',
            accent2: '#000000',
            tickerBg: '#004040',
            tickerFg: '#C0C0C0',
            chromeBg:      '#C0C0C0',
            chromeHeadBg:  '#000080',
            chromeHeadFg:  '#FFFFFF',
            chromeHoverFg: '#000000',
            labelBg: '#C0C0C0',
            labelFg: '#000000',
            popupHoverBg: '#000080',
            popupHoverFg: '#FFFFFF',
            scrollTrack:     '#C0C0C0',
            scrollThumbLight: '#FFFFFF',
            scrollThumbDark:  '#808080',
        },
        norton: {
            green:   '#FFFFFF',
            bg:      '#000080',
            accent1: '#00FFFF',
            accent2: '#FFFF00',
            tickerBg: '#000040',
        },
    };

    let currentTheme = 'zxspectrum';

    const themeLabelOverrides = {
        green: 'Green phosphor',
        amber: 'Amber phosphor',
        white: 'White phosphor',
        red: 'Red phosphor',
        blue: 'Blue phosphor',
        compaqportable: 'Compaq Portable',
        segagenesis: 'Sega Genesis',
        zxspectrum: 'ZX Spectrum',
        gameboycolor: 'Game Boy Color',
        nokia3310: 'Nokia 3310',
        casiogshock: 'Casio G-Shock',
        casiofx330: 'Casio FX-330',
        teletext: 'Teletext',
        winvistadark: 'Windows Vista Midnight',
        win98: 'Windows 98',
        win95: 'Windows 95',
        norton: 'Norton Commander',
    };

    function titleCaseWords(s) {
        return s
            .split(' ')
            .filter(Boolean)
            .map(w => w.charAt(0).toUpperCase() + w.slice(1))
            .join(' ');
    }

    function getThemeLabel(key) {
        if (themes[key] && themes[key].label) return themes[key].label;
        if (themeLabelOverrides[key]) return themeLabelOverrides[key];
        return titleCaseWords(
            key
                .replace(/_/g, ' ')
                .replace(/([a-z])(\d)/g, '$1 $2')
        );
    }

    function highlightTheme(themeKey) {
        document.querySelectorAll('#terminalPopup .hl-color').forEach(item => {
            item.classList.toggle('hl', item.dataset.theme === themeKey);
        });
    }

    function buildThemeMenu() {
        const host = document.getElementById('themeMenu');
        if (!host) return;
        host.innerHTML = '';

        const keys = Object.keys(themes);
        const mono = ['green', 'amber', 'white', 'red', 'blue'];
        const colorKeys = keys.filter(k => !mono.includes(k));

        function addSection(name, keyList) {
            const head = document.createElement('div');
            head.className = 'popup-item popup-section';
            head.style.opacity = '0.6';
            head.style.cursor = 'default';
            head.style.fontSize = '17px';
            head.textContent = name;
            host.appendChild(head);
            keyList.forEach(key => {
                const item = document.createElement('div');
                item.className = 'popup-item hl-color';
                item.dataset.theme = key;
                item.textContent = getThemeLabel(key) + (key === currentTheme ? ' (default)' : '');
                item.onclick = (e) => {
                    e.stopPropagation();
                    setColor(key, item);
                };
                host.appendChild(item);
            });
        }

        addSection('── Monochrome ──', mono);
        addSection('── Color schemes ──', colorKeys);

        highlightTheme(currentTheme);
    }

    function setColor(theme, el) {
        const t = themes[theme];
        if (!t) return;
        currentTheme = theme;
        document.documentElement.style.setProperty('--green', t.green);
        document.documentElement.style.setProperty('--bg', t.bg);
        if (t.accent1) document.documentElement.style.setProperty('--accent1', t.accent1);
        if (t.accent2) document.documentElement.style.setProperty('--accent2', t.accent2);
        if (t.tickerBg) document.documentElement.style.setProperty('--ticker-bg', t.tickerBg);
        if (t.tickerFg != null) document.documentElement.style.setProperty('--ticker-fg', t.tickerFg);
        else document.documentElement.style.removeProperty('--ticker-fg');
        // Never use black for dropdowns/popups – use explicit chromeBg or accent1 when text color is black
        const chromeBgVal = t.chromeBg != null ? t.chromeBg : (t.green === '#000000' ? (t.accent1 || '#333') : t.green);
        document.documentElement.style.setProperty('--chrome-bg', chromeBgVal);
        document.documentElement.style.setProperty('--chrome-head-bg', t.chromeHeadBg != null ? t.chromeHeadBg : '#000000');
        document.documentElement.style.setProperty('--chrome-head-fg', t.chromeHeadFg != null ? t.chromeHeadFg : t.green);
        document.documentElement.style.setProperty('--chrome-hover-fg', t.chromeHoverFg != null ? t.chromeHoverFg : t.green);
        document.documentElement.style.setProperty('--popup-hover-bg', t.popupHoverBg != null ? t.popupHoverBg : '#000000');
        document.documentElement.style.setProperty('--popup-hover-fg', t.popupHoverFg != null ? t.popupHoverFg : t.green);
        document.documentElement.style.setProperty('--label-fg', t.labelFg != null ? t.labelFg : '#000000');
        document.documentElement.style.setProperty('--label-bg', t.labelBg != null ? t.labelBg : 'var(--green)');
        // Win95-style scrollbar palette
        const scrollTrack = t.scrollTrack != null ? t.scrollTrack : chromeBgVal;
        const scrollThumbLight = t.scrollThumbLight != null ? t.scrollThumbLight : '#ffffff';
        const scrollThumbDark = t.scrollThumbDark != null ? t.scrollThumbDark : '#808080';
        document.documentElement.style.setProperty('--scroll-track', scrollTrack);
        document.documentElement.style.setProperty('--scroll-thumb', scrollTrack);
        document.documentElement.style.setProperty('--scroll-thumb-light', scrollThumbLight);
        document.documentElement.style.setProperty('--scroll-thumb-dark', scrollThumbDark);
        document.documentElement.style.setProperty('--scroll-thumb-border', scrollThumbDark);
        highlightTheme(theme);
        updateThemeDefaultLabel(theme);
        playBeep();
        urlGo('woundheir.com/setup/terminal/color/' + theme);
    }

    function updateThemeDefaultLabel(themeKey) {
        document.querySelectorAll('#terminalPopup .hl-color, #terminalPopup .submenu [data-theme]').forEach(item => {
            const k = item.dataset.theme;
            if (!k) return;
            item.textContent = getThemeLabel(k) + (k === themeKey ? ' (default)' : '');
        });
    }

    // ── Font ──
    function setFont(font, el) {
        document.querySelector('.terminal').style.fontFamily = `'${font}', monospace`;
        document.querySelectorAll('.popup-item.hl').forEach(i => {
            if (i.closest('#terminalPopup')) i.classList.remove('hl');
        });
        if (el) el.classList.add('hl');
        urlGo('woundheir.com/setup/terminal/font/' + font.replace(' ','-').toLowerCase());
    }

    // ── Terminal beep (effects toggle) ──
    function playBeep() {
        try {
            const c = new (window.AudioContext || window.webkitAudioContext)();
            const t = c.currentTime;
            const o = c.createOscillator();
            const g = c.createGain();
            o.type = 'square';
            o.frequency.value = 880;
            g.gain.setValueAtTime(0.15, t);
            g.gain.linearRampToValueAtTime(0, t + 0.06);
            o.connect(g); g.connect(c.destination);
            o.start(t); o.stop(t + 0.07);
        } catch (e) {}
    }

    // ── Misc toggles (CRT effects) ──
    const miscState = { scan: true, flicker: false, glitch: false, dynoise: false, rgb: false, raster: false, bleed: false };

    function setEffectValue(el, on) {
        const val = el.querySelector && el.querySelector('.effect-value');
        if (val) val.textContent = on ? '[ ON  ]' : '[ OFF ]';
    }
    function toggleScanlines(el) {
        playBeep();
        miscState.scan = !miscState.scan;
        setEffectValue(el, miscState.scan);
        const term = document.getElementById('terminal');
        term.classList.toggle('scanlines-on', miscState.scan);
    }
    function toggleFlicker(el) {
        playBeep();
        miscState.flicker = !miscState.flicker;
        setEffectValue(el, miscState.flicker);
        const term = document.getElementById('terminal');
        term.classList.toggle('flicker-on', miscState.flicker);
    }
    function toggleGlitch(el) {
        playBeep();
        miscState.glitch = !miscState.glitch;
        setEffectValue(el, miscState.glitch);
        document.getElementById('terminal').classList.toggle('glitch-on', miscState.glitch);
    }
    function toggleDynoise(el) {
        playBeep();
        miscState.dynoise = !miscState.dynoise;
        setEffectValue(el, miscState.dynoise);
        document.getElementById('terminal').classList.toggle('dynoise-on', miscState.dynoise);
    }
    function toggleRgb(el) {
        playBeep();
        miscState.rgb = !miscState.rgb;
        setEffectValue(el, miscState.rgb);
        document.getElementById('terminal').classList.toggle('rgb-on', miscState.rgb);
    }
    function toggleRaster(el) {
        playBeep();
        miscState.raster = !miscState.raster;
        setEffectValue(el, miscState.raster);
        document.getElementById('terminal').classList.toggle('raster-on', miscState.raster);
    }
    function toggleBleed(el) {
        playBeep();
        miscState.bleed = !miscState.bleed;
        setEffectValue(el, miscState.bleed);
        document.getElementById('terminal').classList.toggle('bleed-on', miscState.bleed);
    }
    function resetTerminalOptions() {
        const term = document.getElementById('terminal');

        // Default theme: Norton Commander
        setColor('norton');
        buildThemeMenu();

        // Reset font (Courier New is the default)
        setFont('Courier New', document.getElementById('fontCourier'));

        // Default effects: scanlines ON, flicker ON, glitch ON; rest OFF
        miscState.scan = true;
        miscState.flicker = true;
        miscState.glitch = true;
        miscState.dynoise = false;
        miscState.rgb = false;
        miscState.raster = false;
        miscState.bleed = false;

        term.classList.toggle('scanlines-on', miscState.scan);
        term.classList.toggle('flicker-on', miscState.flicker);
        term.classList.toggle('glitch-on', miscState.glitch);
        term.classList.toggle('dynoise-on', miscState.dynoise);
        term.classList.toggle('rgb-on', miscState.rgb);
        term.classList.toggle('raster-on', miscState.raster);
        term.classList.toggle('bleed-on', miscState.bleed);

        const scanEl = document.getElementById('opt-scan');
        const flickEl = document.getElementById('opt-flicker');
        const glitchEl = document.getElementById('opt-glitch');
        const dynEl = document.getElementById('opt-dynoise');
        const rgbEl = document.getElementById('opt-rgb');
        const rasEl = document.getElementById('opt-raster');
        const bleEl = document.getElementById('opt-bleed');
        setEffectValue(scanEl, true);
        setEffectValue(flickEl, true);
        setEffectValue(glitchEl, true);
        setEffectValue(dynEl, false);
        setEffectValue(rgbEl, false);
        setEffectValue(rasEl, false);
        setEffectValue(bleEl, false);

        urlGo('woundheir.com/setup/terminal/reset');
    }

    // ── Menu toggle ──
    let activeMenu = null;

    function toggleMenu(id, e) {
        e.stopPropagation();
        closeAllPopups();
        const el = document.getElementById(id);
        if (activeMenu && activeMenu !== id) {
            document.getElementById(activeMenu).classList.remove('active');
        }
        el.classList.toggle('active');
        activeMenu = el.classList.contains('active') ? id : null;
        if (activeMenu) urlGo('woundheir.com/' + id.replace('m','').toLowerCase());
    }

    function closeAll() {
        if (activeMenu) {
            document.getElementById(activeMenu).classList.remove('active');
            activeMenu = null;
        }
        const langSub = document.getElementById('langSubmenu');
        if (langSub) langSub.style.display = 'none';
        if (langSubHideTimer) clearTimeout(langSubHideTimer);
        langSubHideTimer = null;
        urlGo('woundheir.com');
    }

    // ── Popups ──
    let activePopup = null;

    function openPopup(id, e) {
        if (e) e.stopPropagation();
        closeAllPopups();
        document.getElementById(id).classList.add('open');
        activePopup = id;
        urlGo('woundheir.com/setup/' + id.replace('Popup','').toLowerCase());
    }

    function closePopup(id) {
        document.getElementById(id).classList.remove('open');
        activePopup = null;
        urlGo('woundheir.com');
    }

    function closeAllPopups() {
        document.querySelectorAll('.popup').forEach(p => p.classList.remove('open'));
        const ap = document.getElementById('aboutPage');
        if (ap) ap.classList.remove('open');
        activePopup = null;
    }

    function openAboutPage(e) {
        if (e) e.stopPropagation();
        closeAll();
        closeAllPopups();
        document.getElementById('aboutPage').classList.add('open');
        activePopup = 'aboutPage';
        urlGo('woundheir.com/help/about');
    }

    function closeAboutPage() {
        document.getElementById('aboutPage').classList.remove('open');
        activePopup = null;
        urlGo('woundheir.com');
    }

    // ── URL bar ──
    function urlGo(url) {
        document.getElementById('urlText').textContent = 'http://' + url;
    }

    // ── Misc actions ──
    function viewSource() {
        window.open('view-source:' + window.location.href, '_blank');
        closeAll();
    }

    function toggleFullscreen() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else document.exitFullscreen();
        closeAll();
    }

    // ── Session timer since visit ──
    const sessionStart = Date.now();
    function updateSessionTimer() {
        const el = document.getElementById('sessionTimer');
        if (!el) return;
        const elapsed = Math.floor((Date.now() - sessionStart) / 1000);
        const mm = String(Math.floor(elapsed / 60)).padStart(2, '0');
        const ss = String(elapsed % 60).padStart(2, '0');
        el.textContent = 'session ' + mm + ':' + ss;
    }
    setInterval(updateSessionTimer, 1000);
    updateSessionTimer();

    // ── Ticker: random order each load ──
    (function initTicker() {
        const phrases = [
            '► For better experience use fullscreen — View › Fullscreen ◄',
            '► Customize your terminal — Setup › Terminal options › Color scheme ◄',
            '► Download free gif on Download › Gif ◄',
            '► A suspicious <span class="ticker-malware">malware</span> is detected! ◄',
            '► Welcome to woundheir.com ◄',
        ];
        const shuffled = [...phrases].sort(() => Math.random() - 0.5);
        const text = shuffled.join(' &nbsp;&nbsp; • &nbsp;&nbsp; ');
        const s1 = document.getElementById('tickerSpan1');
        const s2 = document.getElementById('tickerSpan2');
        if (s1) s1.innerHTML = text;
        if (s2) s2.innerHTML = text;

        // Smooth speed change on hover (no jump): JS-driven scroll
        (function runTickerScroll() {
            const track = document.getElementById('tickerTrack');
            const bar = document.getElementById('tickerBar');
            const span1 = document.getElementById('tickerSpan1');
            if (!track || !bar || !span1) return;
            const loopWidth = span1.offsetWidth;
            if (loopWidth <= 0) return;

            let position = 0;
            const baseSpeed = 90;
            const hoverSpeed = 28;
            const lerp = 0.06;
            let speed = baseSpeed;
            let lastTime = performance.now();
            let hover = false;

            bar.addEventListener('mouseenter', () => { hover = true; });
            bar.addEventListener('mouseleave', () => { hover = false; });

            function tick(now) {
                const dt = (now - lastTime) / 1000;
                lastTime = now;
                const target = hover ? hoverSpeed : baseSpeed;
                speed += (target - speed) * lerp;
                position += speed * dt;
                if (position >= loopWidth) position -= loopWidth;
                if (position < 0) position += loopWidth;
                track.style.transform = 'translateX(' + (-position) + 'px)';
                requestAnimationFrame(tick);
            }
            requestAnimationFrame(tick);
        })();
    })();

    // ── Random theme + effects on first load ──
    (function initRandom() {
        const keys = Object.keys(themes);
        const rKey = keys[Math.floor(Math.random() * keys.length)];
        setColor(rKey);
        buildThemeMenu();

        // Scanlines always on + 1-2 random extras from current valid effects
        const term = document.getElementById('terminal');
        const validFx = ['flicker','glitch','dynoise','rgb','raster','bleed'];
        const shuffled = validFx.sort(() => Math.random() - 0.5);
        const extras = shuffled.slice(0, 1 + Math.floor(Math.random() * 2));
        miscState.scan = true;
        term.classList.add('scanlines-on');
        extras.forEach(fx => {
            miscState[fx] = true;
            term.classList.add(fx + '-on');
        });
        // Never enable scanlines + raster together
        if (miscState.scan && miscState.raster) {
            miscState.raster = false;
            term.classList.remove('raster-on');
        }
        // Sync popup labels (effect value only)
        extras.forEach(fx => {
            const el = document.getElementById('opt-' + fx);
            if (el) setEffectValue(el, true);
        });
    })();

    // ── Boot → Grid ──
    (function runTerminal() {
        const bootLines = document.getElementById('bootLines');
        const grid      = document.getElementById('portfolioGrid');

        function rnd(min, max) { return min + Math.random() * (max - min); }
        function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

        function bootSound(freq, duration, gain) {
            try {
                const c = new (window.AudioContext || window.webkitAudioContext)();
                const t = c.currentTime;
                const o = c.createOscillator();
                const g = c.createGain();
                o.type = 'square';
                o.frequency.value = freq;
                g.gain.setValueAtTime(gain || 0.12, t);
                g.gain.linearRampToValueAtTime(0, t + (duration || 0.06));
                o.connect(g); g.connect(c.destination);
                o.start(t); o.stop(t + (duration || 0.07));
            } catch(e) {}
        }

        async function typeLine(text, statusText, statusClass) {
            const line = document.createElement('div');
            line.className = 'boot-line';
            const span = document.createElement('span');
            span.className = 'c';
            span.style.display = 'inline';
            line.appendChild(span);
            bootLines.appendChild(line);
            for (let i = 0; i < text.length; i++) {
                span.textContent += text[i];
                await delay(rnd(18, 50));
            }
            if (statusText) {
                const s = document.createElement('span');
                s.className = statusClass || '';
                s.textContent = statusText;
                line.appendChild(s);
            }
            await delay(rnd(80, 180));
        }

        function goToGrid() {
            bootLines.style.transition = 'opacity 0.5s';
            bootLines.style.opacity = '0';
            setTimeout(() => {
                bootLines.style.display = 'none';
                grid.style.display = 'grid';
            }, 520);
        }

        (async () => {
            bootSound(800, 0.04, 0.1);
            await typeLine('Initializing display... ', '[OK]', 'boot-status-ok');
            bootSound(900, 0.03, 0.08);
            await typeLine('Loading system... ', '[OK]', 'boot-status-ok');
            bootSound(600, 0.05, 0.1);
            await typeLine('Checking memory.... ', '[CORRUPTED]', 'boot-status-corrupted');
            bootSound(400, 0.08, 0.15);
            await typeLine('Loading graphics... ', '[OK]', 'boot-status-ok');
            bootSound(350, 0.06, 0.12);
            for (let i = 0; i < 3; i++) {
                const empty = document.createElement('div');
                empty.className = 'boot-line';
                empty.style.minHeight = '1.35em';
                bootLines.appendChild(empty);
            }
            await typeLine('Continue');
            const lastLine = bootLines.lastElementChild;
            if (lastLine) {
                const cursor = document.createElement('span');
                cursor.className = 'boot-prompt-cursor';
                cursor.setAttribute('aria-hidden', 'true');
                cursor.textContent = '\u258C';
                lastLine.appendChild(cursor);
            }
            const bootScreen = document.getElementById('bootScreen');
            if (bootScreen) {
                bootScreen.style.cursor = 'pointer';
                bootScreen.addEventListener('click', function once() {
                    bootScreen.removeEventListener('click', once);
                    goToGrid();
                }, { once: true });
            } else {
                await delay(400);
                goToGrid();
            }
        })();

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (activePopup === 'aboutPage') { closeAboutPage(); return; }
                if (activePopup) { closePopup(activePopup); return; }
                closeAll();
                closeAllPopups();
                return;
            }
            if (activePopup) return;
            if (e.ctrlKey && e.key === 'r') { e.preventDefault(); location.reload(); return; }
            if (e.key === 'F11') { e.preventDefault(); toggleFullscreen(); return; }
        });

    })();

    // Prevent clicks inside popups from closing them
    document.querySelectorAll('.popup').forEach(p => {
        p.addEventListener('click', e => e.stopPropagation());
    });

    document.addEventListener('click', () => { closeAll(); closeAllPopups(); });
</script>

</body>
</html>
